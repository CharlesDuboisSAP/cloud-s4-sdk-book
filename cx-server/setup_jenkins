# Cleanup
rm helm-v2.10.0-rc.1-linux-amd64.tar.gz || true
rm values.yaml || true

# Install Helm
wget https://storage.googleapis.com/kubernetes-helm/helm-v2.10.0-rc.1-linux-amd64.tar.gz
tar -zxvf helm-v2.10.0-rc.1-linux-amd64.tar.gz
sudo mv linux-amd64/helm /usr/local/bin/helm

# Assign tiller to a cluster-admin role
kubectl create serviceaccount --namespace kube-system tiller
sleep 10
kubectl create clusterrolebinding tiller-cluster-rule --clusterrole=cluster-admin --serviceaccount=kube-system:tiller
sleep 10
echo 'Waiting for tiller to be ready'
# Install tiller
helm init --service-account tiller --upgrade
sleep 10
kubectl patch deploy --namespace kube-system tiller-deploy -p '{"spec":{"template":{"spec":{"serviceAccount":"tiller"}}}}'
sleep 5
# Pull custom values for Jenkins deployment
wget https://raw.githubusercontent.com/SAP/cloud-s4-sdk-book/google-next/cx-server/values.yaml
# Install Jenkins
helm install --name jenkins-k8s -f values.yaml stable/jenkins

# Cleanup
rm helm-v2.10.0-rc.1-linux-amd64.tar.gz || true
rm values.yaml || true